<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title>Farm in Fantasy</title>
    <script src="react.js"></script>
    <script src="react-dom.js"></script>
    <script src="babel.js"></script>
</head>

<body id="mainBody" class="dayBody">
    <div id="program"></div>
    <script type="text/babel">

        class Field extends React.Component {
            constructor(props) {
                super(props);
                this.choice = this.choice.bind(this);
            };

            choice = () => {
                this.props.decide(this.props.index);
            };

            render() {
                if (this.props.children == '#') {
                    return (
                        <div>
                            <button onClick={this.choice} className="btn fieldFirst">{this.props.children}</button>
                        </div>
                    );
                } else if (this.props.children == '*') {
                    return (
                        <div>
                            <button onClick={this.choice} className="btn fieldSecond">{this.props.children}</button>
                        </div>
                    );
                } else if (this.props.children == '☼') {
                    return (
                        <div>
                            <button onClick={this.choice} className="btn fieldThird">{this.props.children}</button>
                        </div>
                    );
                }
            }
        }

        class FullFields extends React.Component {
            constructor(props) {
                super(props);
                this.state = { fields: ['#', '#', '#', '#', '#', '#'] };
                this.choice = this.choice.bind(this);
            }

            choice = (i) => {
                var mas = this.state.fields;
                var arr = this.props.stat;
                if (arr[0]) {
                    if (mas[i] == '#') {
                        mas[i] = '*';
                    }
                } else if (arr[1]) {
                    if (mas[i] == '*') {
                        mas[i] = '☼';
                    }
                } else if (arr[2]) {
                    if (mas[i] == '☼') {
                        mas[i] = '#';
                        this.props.add();
                    }
                }
                this.setState({ fields: mas });
            };

            view = (item, i) => {
                return (
                    <div>
                        <Field key={i} index={i} decide={this.choice}>{item}</Field>
                    </div>
                );
            };
            render() {
                return (
                    this.state.fields.map(this.view)
                );
            };
        }

        class AllAct extends React.Component {
            constructor(props) {
                super(props);
                /*theShopSelected, waterSelected, bagSelected, cntForBag*/
                this.state = { mas: [false, false, false, 0] };
            }

            theShopChange = () => {
                var arr = this.state.mas;
                if (arr[0] == false) {
                    arr[0] = true;
                    arr[1] = false;
                    arr[2] = false;
                } else {
                    arr[0] = false;
                }
                this.setState({ mas: arr });
            };

            theShopView = () => {
                var arr = this.state.mas;
                if (arr[0]) {
                    return (<button onClick={this.theShopChange} className="btn selectedShop">:</button>);
                } else {
                    return (<button onClick={this.theShopChange} className="btn mainShop">:</button>);
                }
            };

            waterChange = () => {
                var arr = this.state.mas;
                if (!arr[1]) {
                    arr[1] = true;
                    arr[0] = false;
                    arr[2] = false;
                } else {
                    arr[1] = false;
                }
                this.setState({ mas: arr });
            };

            waterView = () => {
                var arr = this.state.mas;
                if (arr[1]) {
                    return (<button onClick={this.waterChange} className="btn selectedShop">▲</button>);
                } else {
                    return (<button onClick={this.waterChange} className="btn mainShop">▲</button>);
                }
            };

            bagChange = () => {
                var arr = this.state.mas;
                if (!arr[2]) {
                    arr[2] = true;
                    arr[0] = false;
                    arr[1] = false;
                } else {
                    arr[2] = false;
                }
                this.setState({ mas: arr });
            };

            bagAddItem = () => {
                var arr = this.state.mas;
                arr[3]++;
                this.setState({ mas: arr });
            };

            bagView = () => {
                var arr = this.state.mas;
                if (arr[2]) {
                    return (<button onClick={this.bagChange} className="btn selectedShop">{arr[3]}</button>);
                } else {
                    return (<button onClick={this.bagChange} className="btn mainShop">{arr[3]}</button>);
                }
            };

            render() {
                return (
                    <div>
                        <div className="groupOfButtons">
                            {this.theShopView()}
                            {this.waterView()}
                            {this.bagView()}
                        </div>
                        <div className="bigFieldBlock">
                            <div className="fieldBlock">
                                <FullFields stat={this.state.mas} add={this.bagAddItem} />
                            </div>
                            <div className="fieldBlock">
                                <FullFields stat={this.state.mas} add={this.bagAddItem} />
                            </div>
                            <div className="fieldBlock">
                                <FullFields stat={this.state.mas} add={this.bagAddItem} />
                            </div>
                        </div>
                    </div>
                );
            };

        }

        class Diolog extends React.Component {
            render() {
                return (
                    <div className="box">
                        <div>Hello, world!</div>
                        <button>Yes</button>
                        <button>No</button>
                    </div>
                );
            };
        }

        class Talks extends React.Component {
            constructor(props) {
                super(props);
                this.state = { talhing: false };
            };
            StartTalking = () => {
                if (this.state.talking) {
                    this.setState({ talking: false });
                } else {
                    this.setState({ talking: true });
                }
            }
            render() {
                if (this.state.talking) {
                    return (
                        <div>
                            <div>
                                <button onClick={this.StartTalking} className="btn talkIn">☺</button>
                            </div>
                            <Diolog />
                        </div>
                    );
                } else {
                    return (
                        <div>
                            <div id>
                                <button onClick={this.StartTalking} className="btn talk">?</button>
                            </div>
                        </div>
                    );
                }

            };
        }

        class DayNight extends React.Component {
            constructor(props) {
                super(props);
                this.state = { day: true };
            };
            change = () => {
                if (this.state.day) {
                    this.setState({ day: false });
                    this.Night();
                    document.body.className = "nightBody";

                } else {
                    this.setState({ day: true });
                    this.Day();
                    document.body.className = "dayBody";
                }
            };
            Day = () => {
                return (
                    <div>
                        <button onClick={this.change} className="btn dayOrNight">day</button>
                    </div>
                );
            };
            Night = () => {
                return (
                    <div>
                        <button onClick={this.change} className="btn dayOrNight">night</button>
                    </div>
                );

            };
            render() {
                if (this.state.day) {
                    return (this.Day());
                } else {
                    return (this.Night());
                }
            };
        }

        var app = document.getElementById("program");
        ReactDOM.render(
            <div>
                <div id="topBtnBar">
                    <DayNight />
                </div>
                <Talks />
                <AllAct />
            </div>,
            app
        );
    </script>
</body>

</html>